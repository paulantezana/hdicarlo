let deliveryItem=[];function exhibitorSetLoading(e){let t=document.querySelectorAll(".jsUserAction");e?t&&t.forEach(e=>{e.setAttribute("disabled","disabled")}):t&&t.forEach(e=>{e.removeAttribute("disabled")})}function searchExhibitorByCode(){let e=document.getElementById("searchExhibitorCode").value;exhibitorSetLoading(!0),RequestApi.fetch("/admin/exhibitor/getByCode",{method:"POST",body:{code:e}}).then(e=>{e.success?document.getElementById("exhibitorDetail").innerHTML=e.view:SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{exhibitorSetLoading(!1)})}function clearDelivery(){document.getElementById("exhibitorDetail").innerHTML="",document.getElementById("searchExhibitorCode").value="",document.getElementById("deliveryObservation").value="",document.getElementById("deliveryItemTableBody").innerHTML="",deliveryItem=[],calculateTotalDelivery()}function saveDelivery(){if(null==document.getElementById("exhibitorId"))return void SnModal.error({title:"Algo salió mal",content:"No se encontró ninguna exibidora"});if(0==deliveryItem.length)return void SnModal.error({title:"Algo salió mal",content:"Ingrese al menos un producto"});let e={};e.exhibitorId=document.getElementById("exhibitorId").value,e.code=document.getElementById("searchExhibitorCode").value,e.observation=document.getElementById("deliveryObservation").value,e.latitude=document.getElementById("currentLatitude").value,e.longitude=document.getElementById("currentLongitude").value,e.item=deliveryItem,e.total=document.getElementById("deliveryTotal").innerHTML,SnModal.confirm({title:"¿Estás seguro de continuar con el registro?",content:"",okText:"Si",okType:"error",cancelText:"No",onOk(){exhibitorSetLoading(!0),RequestApi.fetch("/admin/delivery/save",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),clearDelivery()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{exhibitorSetLoading(!1)})}})}function addDeliveryItem(e){let t=products.find(t=>t.product_id==e),n=`U${generateUniqueId()}`;deliveryItem.push({quantity:1,unitPrice:parseFloat(t.price),total:parseFloat(t.price),productId:parseInt(e),observation:"",description:t.title,uniqueId:n});let i=document.getElementById("deliveryItemTableBody");if(i){let e=`<tr id="deliveryItemRow_${n}">\n                          <td>\n                            <div class="SnBtn-group">\n                              <button class="SnBtn icon error" onclick="minusQuantityDeliveryItem('${n}')"><i class="fas fa-minus"></i></button>\n                              <button class="SnBtn icon success" onclick="plusQuantityDeliveryItem('${n}')"><i class="fas fa-plus"></i></button>\n                            </div>\n                          </td>\n                          <td>\n                            <button class="SnBtn icon primary" onclick="updateDeliveryItem('${n}')"><i class="far fa-comment-dots"></i></button>\n                          </td>\n                          <td>\n                            <div>${t.title} <small id="deliveryItemObservation_${n}"></small></div>\n                            <small>\n                              <span id="deliveryItemQuantity_${n}">1</span>\n                              <span>Unidad(es) a S/. <span id="deliveryItemUnitPrice_${n}">${t.price}</span></span>\n                            </small>\n                          </td>\n                          <td id="deliveryItemTotal_${n}">${t.price}</td>\n                      </tr>`;i.insertAdjacentHTML("beforeend",e)}calculateTotalDelivery()}function minusQuantityDeliveryItem(e){let t=document.getElementById(`deliveryItemQuantity_${e}`),n=document.getElementById(`deliveryItemTotal_${e}`);deliveryItem.forEach((i,l)=>{if(i.uniqueId===e)if(deliveryItem[l].quantity=i.quantity-1,deliveryItem[l].total=deliveryItem[l].quantity*deliveryItem[l].unitPrice,deliveryItem[l].quantity>0)t.innerHTML=deliveryItem[l].quantity,n.innerHTML=deliveryItem[l].total;else{document.getElementById(`deliveryItemRow_${i.uniqueId}`).remove(),deliveryItem.splice(l,1)}}),calculateTotalDelivery()}function plusQuantityDeliveryItem(e){let t=document.getElementById(`deliveryItemQuantity_${e}`),n=document.getElementById(`deliveryItemTotal_${e}`);deliveryItem.forEach((i,l)=>{i.uniqueId===e&&(deliveryItem[l].quantity=i.quantity+1,deliveryItem[l].total=deliveryItem[l].quantity*deliveryItem[l].unitPrice,t.innerHTML=deliveryItem[l].quantity,n.innerHTML=deliveryItem[l].total)}),calculateTotalDelivery()}function calculateTotalDelivery(){let e=0;deliveryItem.forEach(t=>{e+=t.total}),document.getElementById("deliveryTotal").innerHTML=e}function updateDeliveryItem(e){SnModal.open("deliveryItemModalForm");let t=deliveryItem.find(t=>t.uniqueId==e);t&&(document.getElementById("deliveryItemUniqueId").value=t.uniqueId,document.getElementById("deliveryItemObservation").value=t.observation,document.getElementById("deliveryItemUnitPrice").value=t.unitPrice)}function deliveryItemSubmit(e){e.preventDefault();let t=document.getElementById("deliveryItemUniqueId").value,n=document.getElementById("deliveryItemObservation").value,i=document.getElementById("deliveryItemUnitPrice").value,l=document.getElementById(`deliveryItemObservation_${t}`),d=document.getElementById(`deliveryItemUnitPrice_${t}`),r=document.getElementById(`deliveryItemTotal_${t}`);deliveryItem.forEach((e,o)=>{e.uniqueId===t&&(deliveryItem[o].unitPrice=i,deliveryItem[o].observation=n,deliveryItem[o].total=deliveryItem[o].quantity*deliveryItem[o].unitPrice,l.innerHTML=`(${deliveryItem[o].observation})`,d.innerHTML=deliveryItem[o].unitPrice,r.innerHTML=deliveryItem[o].total,SnModal.close("deliveryItemModalForm"))}),calculateTotalDelivery()}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("searchExhibitorCode");e&&e.addEventListener("keyup",e=>{"Enter"==e.code&&searchExhibitorByCode()}),geoGetCurrentPosition().then(e=>{document.getElementById("currentLatitude").value=e.lat,document.getElementById("currentLongitude").value=e.lng}).catch(e=>SnMessage.error({content:e}))});