let orderItem=[];function exhibitorSetLoading(e){let t=document.querySelectorAll(".jsUserAction");e?t&&t.forEach(e=>{e.setAttribute("disabled","disabled")}):t&&t.forEach(e=>{e.removeAttribute("disabled")})}function searchExhibitorByCode(){let e=document.getElementById("searchExhibitorCode").value;exhibitorSetLoading(!0),RequestApi.fetch("/admin/exhibitor/getByCode",{method:"POST",body:{code:e}}).then(e=>{e.success?document.getElementById("exhibitorDetail").innerHTML=e.view:SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{exhibitorSetLoading(!1)})}function clearOrder(){document.getElementById("exhibitorDetail").innerHTML="",document.getElementById("searchExhibitorCode").value="",document.getElementById("orderObservation").value="",document.getElementById("orderItemTableBody").innerHTML="",orderItem=[],calculateTotalOrder()}function saveOrder(){if(null==document.getElementById("exhibitorId"))return void SnModal.error({title:"Algo salió mal",content:"No se encontró ninguna exibidora"});if(0==orderItem.length)return void SnModal.error({title:"Algo salió mal",content:"Ingrese al menos un producto"});let e={};e.code=document.getElementById("searchExhibitorCode").value,e.observation=document.getElementById("orderObservation").value,e.exhibitorId=document.getElementById("exhibitorId").value,e.latitude=document.getElementById("currentLatitude").value,e.longitude=document.getElementById("currentLongitude").value,e.dateOfDelivery=document.getElementById("orderDateOfDelivery").value,e.item=orderItem,e.total=document.getElementById("orderTotal").innerHTML,SnModal.confirm({title:"¿Estás seguro de continuar con el registro?",content:"",okText:"Si",okType:"error",cancelText:"No",onOk(){exhibitorSetLoading(!0),RequestApi.fetch("/admin/order/save",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),clearOrder()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{exhibitorSetLoading(!1)})}})}function addOrderItem(e){let t=products.find(t=>t.product_id==e),n=`U${generateUniqueId()}`;orderItem.push({quantity:1,unitPrice:parseFloat(t.price),total:parseFloat(t.price),productId:parseInt(e),observation:"",description:t.title,uniqueId:n});let r=document.getElementById("orderItemTableBody");if(r){let e=`<tr id="orderItemRow_${n}">\n                            <td>\n                              <div class="SnBtn-group">\n                                <button class="SnBtn icon error" onclick="minusQuantityOrderItem('${n}')"><i class="fas fa-minus"></i></button>\n                                <button class="SnBtn icon success" onclick="plusQuantityOrderItem('${n}')"><i class="fas fa-plus"></i></button>\n                              </div>\n                            </td>\n                            <td>\n                              <button class="SnBtn icon primary" onclick="updateOrderItem('${n}')"><i class="far fa-comment-dots"></i></button>\n                            </td>\n                            <td>\n                              <div>${t.title} <small id="orderItemObservation_${n}"></small></div>\n                              <small>\n                                <span id="orderItemQuantity_${n}">1</span>\n                                <span>Unidad(es) a S/. <span id="orderItemUnitPrice_${n}">${t.price}</span></span>\n                              </small>\n                            </td>\n                            <td id="orderItemTotal_${n}">${t.price}</td>\n                        </tr>`;r.insertAdjacentHTML("beforeend",e)}calculateTotalOrder()}function minusQuantityOrderItem(e){let t=document.getElementById(`orderItemQuantity_${e}`),n=document.getElementById(`orderItemTotal_${e}`);orderItem.forEach((r,o)=>{if(r.uniqueId===e)if(orderItem[o].quantity=r.quantity-1,orderItem[o].total=orderItem[o].quantity*orderItem[o].unitPrice,orderItem[o].quantity>0)t.innerHTML=orderItem[o].quantity,n.innerHTML=orderItem[o].total;else{document.getElementById(`orderItemRow_${r.uniqueId}`).remove(),orderItem.splice(o,1)}}),calculateTotalOrder()}function plusQuantityOrderItem(e){let t=document.getElementById(`orderItemQuantity_${e}`),n=document.getElementById(`orderItemTotal_${e}`);orderItem.forEach((r,o)=>{r.uniqueId===e&&(orderItem[o].quantity=r.quantity+1,orderItem[o].total=orderItem[o].quantity*orderItem[o].unitPrice,t.innerHTML=orderItem[o].quantity,n.innerHTML=orderItem[o].total)}),calculateTotalOrder()}function calculateTotalOrder(){let e=0;orderItem.forEach(t=>{e+=t.total}),document.getElementById("orderTotal").innerHTML=e}function updateOrderItem(e){SnModal.open("ordenItemModalForm");let t=orderItem.find(t=>t.uniqueId==e);t&&(document.getElementById("ordenItemUniqueId").value=t.uniqueId,document.getElementById("ordenItemObservation").value=t.observation,document.getElementById("ordenItemUnitPrice").value=t.unitPrice)}function ordenItemSubmit(e){e.preventDefault();let t=document.getElementById("ordenItemUniqueId").value,n=document.getElementById("ordenItemObservation").value,r=document.getElementById("ordenItemUnitPrice").value,o=document.getElementById(`orderItemObservation_${t}`),d=document.getElementById(`orderItemUnitPrice_${t}`),i=document.getElementById(`orderItemTotal_${t}`);orderItem.forEach((e,a)=>{e.uniqueId===t&&(orderItem[a].unitPrice=r,orderItem[a].observation=n,orderItem[a].total=orderItem[a].quantity*orderItem[a].unitPrice,o.innerHTML=`(${orderItem[a].observation})`,d.innerHTML=orderItem[a].unitPrice,i.innerHTML=orderItem[a].total,SnModal.close("ordenItemModalForm"))}),calculateTotalOrder()}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("searchExhibitorCode");e&&e.addEventListener("keyup",e=>{"Enter"==e.code&&searchExhibitorByCode()}),geoGetCurrentPosition().then(e=>{document.getElementById("currentLatitude").value=e.lat,document.getElementById("currentLongitude").value=e.lng}).catch(e=>SnMessage.error({content:e}))});