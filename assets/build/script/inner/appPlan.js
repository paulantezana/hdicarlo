let pValidator,appPlanState={modalType:"create",modalName:"appPlanModalForm",loading:!1};function appPlanSetLoading(e){appPlanState.loading=e;let a=document.querySelectorAll(".jsAppPlanAction"),n=document.getElementById("appPlanFormSubmit");appPlanState.loading?(n&&(n.setAttribute("disabled","disabled"),n.classList.add("loading")),a&&a.forEach(e=>{e.setAttribute("disabled","disabled")})):(n&&(n.removeAttribute("disabled"),n.classList.remove("loading")),a&&a.forEach(e=>{e.removeAttribute("disabled")}))}function appPlanList(e=1,a=20,n=""){let t=document.getElementById("appPlanTable");t&&(SnFreeze.freeze({selector:"#appPlanTable"}),RequestApi.fetch(`/inner/appPlan/table?limit=${a}&page=${e}&search=${n}`,{method:"GET"}).then(e=>{e.success?t.innerHTML=e.view:SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{SnFreeze.unFreeze("#appPlanTable")}))}function appPlanClearForm(){let e=document.getElementById("appPlanForm"),a=document.getElementById("appPlanDescripcion"),n=document.getElementById("appPlanIntervalTableBody");e&&e.reset(),a&&setTimeout(()=>{a.focus()},500),n&&(n.innerHTML=""),pValidator.reset()}function appPlanSubmit(e){if(e.preventDefault(),!pValidator.validate())return;appPlanSetLoading(!0);let a={};a.description=document.getElementById("appPlanDescripcion").value;let n=document.getElementById("appPlanIntervalTableBody");a.interval=[...n.children].map((e,a)=>{let n=e.dataset.uniqueid;return{appPlanIntervalId:"is-false"===e.dataset.isnew?n:0,appPaymentIntervalId:document.getElementById(`appPlanIntervalProcessTypeId_${n}`).value,price:document.getElementById(`appPlanIntervalPrice_${n}`).value}}),"update"===appPlanState.modalType&&(a.appPlanId=document.getElementById("appPlanId").value||0),RequestApi.fetch("/inner/appPlan/"+appPlanState.modalType,{method:"POST",body:a}).then(e=>{e.success?(SnModal.close(appPlanState.modalName),SnMessage.success({content:e.message}),appPlanList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{appPlanSetLoading(!1)})}function appPlanDelete(e,a=""){SnModal.confirm({title:"¿Estás seguro de eliminar este registro?",content:a,okText:"Si",okType:"error",cancelText:"No",onOk(){appPlanSetLoading(!0),RequestApi.fetch("/inner/appPlan/delete",{method:"POST",body:{appPlanId:e||0}}).then(e=>{e.success?(SnMessage.success({content:e.message}),appPlanList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{appPlanSetLoading(!1)})}})}function appPlanShowModalCreate(){appPlanState.modalType="create",appPlanClearForm(),SnModal.open(appPlanState.modalName)}function appPlanShowModalUpdate(e){appPlanState.modalType="update",appPlanGetById(e)}function appPlanGetById(e){appPlanClearForm(),appPlanSetLoading(!0),RequestApi.fetch("/inner/appPlan/id",{method:"POST",body:{appPlanId:e||0}}).then(e=>{e.success?(document.getElementById("appPlanDescripcion").value=e.result.description,document.getElementById("appPlanId").value=e.result.app_plan_id,e.result.interval.forEach(e=>addAppPlanInterval(e,!1)),SnModal.open(appPlanState.modalName)):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{appPlanSetLoading(!1)})}function appPlanToExcel(){let e=document.getElementById("appPlanCurrentTable");e&&TableToExcel(e.outerHTML,"appPlan","appPlanes")}function appPlanToPrint(){printArea("appPlanCurrentTable")}function addAppPlanInterval(e={},a=!0){let n=document.getElementById("appPlanIntervalTableBody"),t="";if(a&&(e.app_plan_interval_id=generateUniqueId()),appPaymentInterval.forEach(e=>{t+=`<option value="${e.app_payment_interval_id}">${e.description}</option>`}),n){let l=`<tr data-isnew="${a?"is-true":"is-false"}" data-uniqueid="${e.app_plan_interval_id}" id="appPlanIntervalRow_${e.app_plan_interval_id}">\n                            <td>\n                                <div class="SnForm-item" style="margin-bottom: 0"><select class="SnForm-control" required id="appPlanIntervalProcessTypeId_${e.app_plan_interval_id}">${t}</select></div>\n                            </td>\n                            <td>\n                                <div class="SnForm-item" style="margin-bottom: 0"><input class="SnForm-control" required type="number" id="appPlanIntervalPrice_${e.app_plan_interval_id}"></div>\n                            </td>\n                            <td>\n                                <button type="button" class="SnBtn radio icon" onclick="removeAppPlanInterval('${e.app_plan_interval_id}')"><i class="fas fa-trash-alt"></i></button>\n                            </td>\n                        </tr>`;n.insertAdjacentHTML("beforeend",l),document.getElementById(`appPlanIntervalProcessTypeId_${e.app_plan_interval_id}`).value=e.app_payment_interval_id,document.getElementById(`appPlanIntervalPrice_${e.app_plan_interval_id}`).value=e.price,appPlanSetValidate()}}function removeAppPlanInterval(e){let a=document.getElementById(`appPlanIntervalRow_${e}`);if(a){if("is-true"==a.dataset.isnew)return void a.remove();SnModal.confirm({title:"¿Estás seguro de eliminar el registro?",content:"",okText:"Si",okType:"error",cancelText:"No",onOk(){appPlanSetLoading(!0),RequestApi.fetch("/inner/appPlan/deleteAppPlanInterval",{method:"POST",body:{appPlanIntervalId:e||0}}).then(e=>{e.success?(SnMessage.success({content:e.message}),a.remove()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{appPlanSetLoading(!1)})}})}}function appPlanSetValidate(){pValidator&&pValidator.destroy(),pValidator=new Pristine(document.getElementById("appPlanForm"))}document.addEventListener("DOMContentLoaded",()=>{appPlanSetValidate(),appPlanList()});