let companyPaymentPValidator;function companyPaymentAll(){let e=document.getElementById("companyPaymentTable");e&&(SnFreeze.freeze({selector:"#companyPaymentTable"}),RequestApi.fetch("/inner/company/getAllPayment",{method:"POST",body:{companyId:companyId}}).then(t=>{t.success?e.innerHTML=t.view:SnModal.error({title:"Algo salió mal",content:t.message})}).finally(e=>{SnFreeze.unFreeze("#companyPaymentTable")}))}function companyPaymentSetLoading(e){let t=document.querySelectorAll(".jsCompanyPaymentAction"),n=document.getElementById("companyPaymentFormSubmit");e?(n&&(n.setAttribute("disabled","disabled"),n.classList.add("loading")),t&&t.forEach(e=>{e.setAttribute("disabled","disabled")})):(n&&(n.removeAttribute("disabled"),n.classList.remove("loading")),t&&t.forEach(e=>{e.removeAttribute("disabled")}))}function companyPaymentShowModalCreate(){companyPaymentSetLoading(!0),RequestApi.fetch("/inner/company/getLastPayment",{method:"POST",body:{companyId:companyId}}).then(e=>{if(e.success){companyPaymentClearForm(),SnModal.open("companyPaymentModalForm");let t=e.result.lastPayment,n=e.result.company,a=!1===t?n.contract_date_of_issue:moment(n.contract_date_of_issue).diff(moment(t.to_date_time))>=0?n.contract_date_of_issue:t.to_date_time,o=moment(a);document.getElementById("companyPaymentFromDatetime").value=o.format("YYYY-MM-DD"),document.getElementById("companyPaymentPrice").value=n.app_plan_price,document.getElementById("companyPaymentDescription").innerHTML=n.app_plan_description;let m=moment(a);m.add(1,n.app_plan_date_interval),document.getElementById("companyPaymentToDatetime").value=m.format("YYYY-MM-DD"),document.getElementById("companyPaymentTotal").value=n.app_plan_price}else SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companyPaymentSetLoading(!1)})}function companyPaymentClearForm(){let e=document.getElementById("companyPaymentForm"),t=document.getElementById("companyPaymentReference");e&&t&&(e.reset(),t.focus()),companyPaymentPValidator.reset()}function companyPaymentSubmit(e){if(e.preventDefault(),!companyPaymentPValidator.validate())return;companyPaymentSetLoading(!0);let t={};t.reference=document.getElementById("companyPaymentReference").value,t.fromDatetime=document.getElementById("companyPaymentFromDatetime").value,t.toDatetime=document.getElementById("companyPaymentToDatetime").value,t.description=document.getElementById("companyPaymentDescription").value,t.total=document.getElementById("companyPaymentTotal").value,t.companyId=companyId,RequestApi.fetch("/inner/company/createPayment",{method:"POST",body:t}).then(e=>{e.success?(SnModal.close("companyPaymentModalForm"),SnMessage.success({content:e.message}),companyPaymentAll()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companyPaymentSetLoading(!1)})}function companyPaymentCanceled(e,t){SnModal.confirm({title:`¿Estás seguro de anular este registro con código: ${t}?`,content:"Ingrese el motivo de la anulación",input:!0,okText:"Si",okType:"error",cancelText:"No",onOk(t){companyPaymentSetLoading(!0),RequestApi.fetch("/inner/company/canceledPayment",{method:"POST",body:{appPaymentId:e,companyId:companyId,message:t}}).then(e=>{e.success?(SnMessage.success({content:e.message}),companyPaymentAll()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companyPaymentSetLoading(!1)})}})}function companyPaymentToPrint(){}function companyPaymentToExcel(){}document.addEventListener("DOMContentLoaded",()=>{companyPaymentPValidator=new Pristine(document.getElementById("companyPaymentForm")),moment.locale("es"),companyPaymentAll()});