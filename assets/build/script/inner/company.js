let pValidator,companyStateModalType="create";function companySetLoading(e){let o=document.querySelectorAll(".jsCompanyAction"),n=document.getElementById("companyFormSubmit");e?(n&&(n.setAttribute("disabled","disabled"),n.classList.add("loading")),o&&o.forEach(e=>{e.setAttribute("disabled","disabled")})):(n&&(n.removeAttribute("disabled"),n.classList.remove("loading")),o&&o.forEach(e=>{e.removeAttribute("disabled")}))}function companyList(e=1,o=20,n=""){let t=document.getElementById("companyTable");t&&(SnFreeze.freeze({selector:"#companyTable"}),RequestApi.fetch(`/inner/company/table?limit=${o}&page=${e}&search=${n}`,{method:"GET"}).then(e=>{e.success?t.innerHTML=e.view:SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{SnFreeze.unFreeze("#companyTable")}))}function companyClearForm(){let e=document.getElementById("companyForm"),o=document.getElementById("companyDocumentNumber");e&&o&&(e.reset(),setTimeout(()=>{o.focus()},500)),pValidator.reset()}function prepareModalUser(e=""){pValidator.destroy(),document.getElementById("userPassword").parentElement.parentElement.classList.remove("hidden"),document.getElementById("userPasswordConfirm").parentElement.parentElement.classList.remove("hidden"),document.getElementById("userPassword").removeAttribute("required"),document.getElementById("userPasswordConfirm").removeAttribute("required"),"update"===e&&(document.getElementById("userPassword").parentElement.parentElement.classList.add("hidden"),document.getElementById("userPasswordConfirm").parentElement.parentElement.classList.add("hidden")),pValidator=new Pristine(document.getElementById("companyForm"))}function companySubmit(e){if(e.preventDefault(),!pValidator.validate())return;companySetLoading(!0);let o={};o.documentNumber=document.getElementById("companyDocumentNumber").value,o.socialReason=document.getElementById("companySocialReason").value,o.commercialReason=document.getElementById("companyCommercialReason").value,o.fiscalAddress=document.getElementById("companyFiscalAddress").value,o.email=document.getElementById("companyEmail").value,o.phone=document.getElementById("companyPhone").value,o.telephone=document.getElementById("companyTelephone").value,o.urlWeb=document.getElementById("companyUrlWeb").value,o.representative=document.getElementById("companyRepresentative").value,o.appPlanId=document.getElementById("companyAppPlanId").value,o.appPaymentIntervalId=document.getElementById("companyAppPaymentIntervalId").value,o.userPassword=document.getElementById("userPassword").value,o.userPasswordConfirm=document.getElementById("userPasswordConfirm").value,"update"===companyStateModalType&&(o.companyId=document.getElementById("companyId").value||0),RequestApi.fetch("/inner/company/"+companyStateModalType,{method:"POST",body:o}).then(e=>{e.success?(SnModal.close("companyModalForm"),SnMessage.success({content:e.message}),companyList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companySetLoading(!1)})}function companyDelete(e,o=""){SnModal.confirm({title:"¿Estás seguro de eliminar este registro?",content:o,okText:"Si",okType:"error",cancelText:"No",onOk(){companySetLoading(!0),RequestApi.fetch("/inner/company/delete",{method:"POST",body:{companyId:e||0}}).then(e=>{e.success?(SnMessage.success({content:e.message}),companyList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companySetLoading(!1)})}})}function companyChangeDevelopment(e,o,n=""){SnModal.confirm({title:`¿Estás seguro de pasar a modo ${0==o?"Producción":"Desarrollo"}?`,content:n,okText:"Si",okType:"error",cancelText:"No",onOk(){companySetLoading(!0),RequestApi.fetch("/inner/company/changeDevelopment",{method:"POST",body:{companyId:e||0,development:!(1==o)}}).then(e=>{e.success?(SnMessage.success({content:e.message}),companyList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companySetLoading(!1)})}})}function companyShowModalCreate(){companyStateModalType="create",companyClearForm(),prepareModalUser(companyStateModalType),SnModal.open("companyModalForm")}function companyShowModalUpdate(e){companyStateModalType="update",companyGetById(e)}function companyGetById(e){companyClearForm(),prepareModalUser(companyStateModalType),companySetLoading(!0),RequestApi.fetch("/inner/company/id",{method:"POST",body:{companyId:e||0}}).then(e=>{e.success?(document.getElementById("companyDocumentNumber").value=e.result.document_number,document.getElementById("companySocialReason").value=e.result.social_reason,document.getElementById("companyCommercialReason").value=e.result.commercial_reason,document.getElementById("companyFiscalAddress").value=e.result.fiscal_address,document.getElementById("companyEmail").value=e.result.email,document.getElementById("companyPhone").value=e.result.phone,document.getElementById("companyTelephone").value=e.result.telephone,document.getElementById("companyUrlWeb").value=e.result.url_web,document.getElementById("companyRepresentative").value=e.result.representative,document.getElementById("companyAppPlanId").value=e.result.app_plan_id,document.getElementById("companyAppPaymentIntervalId").value=e.result.app_payment_interval_id,document.getElementById("companyId").value=e.result.company_id,SnModal.open("companyModalForm")):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companySetLoading(!1)})}function searchDocumentChangeState(e){let o=document.getElementById("companySearchDocument");o&&(e?o.setAttribute("disabled","disabled"):o.removeAttribute("disabled"))}function companySearchDocument(){let e=document.getElementById("companyDocumentNumber").value;searchDocumentChangeState(!0),RequestApi.fetch("/page/queryDocument",{method:"POST",body:{documentNumber:e,documentTypeId:3}}).then(e=>{e.success?(document.getElementById("companySocialReason").value=e.result.full_name,document.getElementById("companyFiscalAddress").value=e.result.full_address):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{searchDocumentChangeState(!1)})}function companyToExcel(){let e=document.getElementById("companyCurrentTable");e&&TableToExcel(e.outerHTML,"Company","Companyes")}function companyShowLogoModal(e){companySetLoading(!0),RequestApi.fetch("/inner/company/id",{method:"POST",body:{companyId:e||0}}).then(e=>{e.success?(document.getElementById("companyLogoId").value=e.result.company_id,document.getElementById("companyLogoSquareImg").setAttribute("src",URL_PATH+e.result.logo),document.getElementById("companyLogoLargeImg").setAttribute("src",URL_PATH+e.result.logo_large),SnModal.open("companyLogoModal")):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{companySetLoading(!1)})}function uploadLogoSquare(){let e=document.getElementById("companyLogoSquare");if(null==e)return;if(void 0===e.files)return void SnModal.error({title:"Error de usuario",content:"Elije almenos un archivo"});let o=e.files[0];null!=o&&null!=o?validateFile(o,["image/png","image/jpeg","image/jpg"],100)?SnModal.confirm({title:"¿Estás seguro de subir el logo?",content:"Logo cuadrada de la empresa",okText:"Si",okType:"error",cancelText:"No",onOk(){let e=new FormData;e.append("logo",o),e.append("companyId",document.getElementById("companyLogoId").value),SnFreeze.freeze({selector:"#companyLogoSquareWrapper"}),RequestApi.fetch("/inner/company/uploadLogoSquare",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),SnModal.close("companyLogoModal"),companyList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{SnFreeze.unFreeze("#companyLogoSquareWrapper")})}}):SnModal.error({title:"Error de usuario",content:"El archivo tiene formato o tamaño incorrecto, solo se aceptan archivos con extension [image/png,image/jpeg,image/jpg]. y un tamaño maximo de 100Kb."}):SnModal.error({title:"Error de usuario",content:"Elije almenos un archivo"})}function uploadLogoLarge(){let e=document.getElementById("companyLogoLarge");if(null==e)return;if(void 0===e.files)return void SnModal.error({title:"Error de usuario",content:"Elije almenos un archivo"});let o=e.files[0];null!=o&&null!=o?validateFile(o,["image/png","image/jpeg","image/jpg"],100)?SnModal.confirm({title:"¿Estás seguro de subir el logo?",content:"Logo largo de la empresa",okText:"Si",okType:"error",cancelText:"No",onOk(){let e=new FormData;e.append("logo",o),e.append("companyId",document.getElementById("companyLogoId").value),SnFreeze.freeze({selector:"#companyLogoLargeWrapper"}),RequestApi.fetch("/inner/company/uploadLogoLarge",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),SnModal.close("companyLogoModal"),companyList()):SnModal.error({title:"Algo salió mal",content:e.message})}).finally(e=>{SnFreeze.unFreeze("#companyLogoLargeWrapper")})}}):SnModal.error({title:"Error de usuario",content:"El archivo tiene formato o tamaño incorrecto, solo se aceptan archivos con extension [image/png,image/jpeg,image/jpg]. y un tamaño maximo de 100Kb."}):SnModal.error({title:"Error de usuario",content:"Elije almenos un archivo"})}function companyToPrint(){printArea("companyCurrentTable")}document.addEventListener("DOMContentLoaded",()=>{pValidator=new Pristine(document.getElementById("companyForm")),document.getElementById("searchContent").addEventListener("keyup",e=>{"Enter"===e.key&&companyList(1,10,e.target.value)}),companyList()});